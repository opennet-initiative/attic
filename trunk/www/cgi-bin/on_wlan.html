#!/bin/sh

export DATE="5.9.2005"
export TITLE="Verwaltung: Opennet"
. ${0%/*}/cgi-bin-pre.sh

cat<<EOF
<script type="text/javascript">document.getElementById('idx02').className="idx selected";</script>

<H1>Verwaltung: Opennet</H1>
EOF

if [ "$REQUEST_METHOD" = "POST" ]; then
	read QUERY_STRING
fi
if [ -z "$QUERY_STRING" ]; then

cat<<EOF
<!-- show the following area only, if user likes more information -->
<a id="switch" href="#" onclick="document.getElementById('description').style.display='inline';this.style.display='none';" style="display:none;">mehr Informationen.</a>
<div id="description">
<br />
	Schön, dass Du Dich für das Mitmachen beim Opennet entschieden hast. Einen ersten Kontakt solltest Du bereits persönlich, über unsere regelmäßigen Treffen oder unsere Mailingliste/Forum geknüpft haben. Nun kann es auch schon los gehen!
<br/>
	Die Adresse des Accesspoints musst Du Dir selbst zuordnen, lege dazu einen Eintrag im <a href="http://wiki.opennet-initiative.de/index.php/Opennet_Nodes">Opennet-Wiki </a>an. (Bitte berücksichtige die Informationen unter <a href="http://wiki.opennet-initiative.de/index.php/Mitmachen">'Mitmachen'</a>).<br><br>
</div>
<script type="text/javascript">
	document.getElementById('switch').style.display='inline';
	document.getElementById('description').style.display='none';
</script>
<!-- ************************************************************ -->
	
	<FORM ACTION="on_wlan.html" CLASS="form" METHOD="POST">
	<TABLE CLASS="shadow0" CELLPADDING="0" CELLSPACING="0"><TR><TD><TABLE CLASS="shadow1" CELLPADDING="0" CELLSPACING="0"><TR><TD><TABLE CLASS="shadow2" CELLPADDING="0" CELLSPACING="0"><TR><TD><TABLE BORDER="0" CLASS="form">
	<TBODY>
	<TR TITLE="Gib eine gültige IP-Adresse ein. In einem Netzwerk darf diese Adresse nur einmal verwendet werden. Beispiele: 192.168.33.127 oder 192.168.33.128">
	<TD>IP-Adresse:</TD>
	<TD><INPUT NAME="wifi_ipaddr" SIZE="48" TYPE="TEXT" VALUE="$(nvram get wifi_ipaddr)"$(if [ "$(nvram get wifi_proto)" != "static" ];then echo ' disabled="disabled"';fi)></TD>
	</TR>
EOF
cat<<EOF
	<TR>
	<TD COLSPAN="2"><INPUT NAME="post_on_wlan" TITLE="Die Einstellungen übernehmen. Diese werden erst nach einem Neustart wirksam." TYPE="SUBMIT" VALUE="Übernehmen">   <INPUT NAME="post_abort" TITLE="Abbruch dieser Dialogseite" TYPE="SUBMIT" VALUE="Abbruch"></TD>
	</TR></TBODY>
	</TABLE></TD></TR></TABLE></TD></TR></TABLE></TD></TR></TABLE></FORM>
EOF

else
	eval $(echo "$QUERY_STRING"|awk -F'&' '{for(i=1;i<=NF;i++){print $i}}')
	DIRTY=
	if [ -n "$post_on_wlan" ]; then
		for V in wifi_ipaddr; do
			eval "C=\$$V"
			C=$(unescape $C)
			if [ "$C" != "$(nvram get $V)" ]; then
				DIRTY=1
				nvram set $V="$C"
			fi
		done
	fi
	if [ -n "$DIRTY" ]; then
		nvram commit>/dev/null 2>&1
cat<<EOF
		<TABLE BORDER="0" CLASS="note">
		<TBODY>
		<TR>
		<TD>Die ge&auml;nderten Einstellungen wurden &uuml;bernommen.
		Die Einstellungen sind erst beim n&auml;chsten <A HREF="reset.html">Neustart</A>
		aktiv.</TD>
		</TR></TBODY>
		</TABLE>
EOF
	else
cat<<EOF
		<TABLE BORDER="0" CLASS="note">
		<TBODY>
		<TR>
		<TD>Es wurden keine Einstellungen ge&auml;ndert.</TD>
		</TR></TBODY>
		</TABLE>
EOF
	fi
fi

. ${0%/*}/cgi-bin-post.sh

#!/bin/sh

gw_addrs=$(/usr/sbin/working_gateways.sh)

# remove old dns-entries, they will be created again by ifup
rm -f /etc/resolv.conf

# use the two first gateways as possible dns-servers
dnsaddrs=
for gw_addr in $gw_addrs; do
	if [ -z "$dnsaddrs" ]; then dnsaddrs=$gw_addr;
	else dnsaddrs="$dnsaddrs,$gw_addr"; break;
	fi
done

# hardcoded fallback
if [ -z "$dnsaddrs" ]; then dnsaddrs="192.168.0.254 192.168.0.249"; fi

nvram set wifi_dns="$(echo $dnsaddrs | awk '{gsub(","," "); print}')"

# nvram commit # not needed cause variables are refreshed after every reset

#!/bin/sh

# get the first gateway
for on_gw in $(nvram get on_gwaddrs); do
	# check if Gateway is tested to work
	if [ "$(echo $on_gw | cut -d":" -f2)" != "y" ]; then continue;
	else on_gw=$(echo $on_gw | cut -d":" -f1); break
	fi
done;

# set titan as fallback, if there is no gateway choosen
if [ -z $on_gw ]; then on_gw="192.168.0.254"; fi

# set gateway information
nvram set on_gw=$on_gw

# remove old dns-entries, they will be created again by ifup
rm -f /etc/resolv.conf; nvram set wifi_dns=$on_gw

# nvram commit # not needed cause variables are refreshed after every reset
